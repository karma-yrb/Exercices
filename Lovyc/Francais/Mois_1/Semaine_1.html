<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lovyc - Tactical Comms (Fran√ßais)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg: #06070d;
            --card: #0f111a;
            --accent: #00fcf4; /* Tactical Cyan */
            --accent-glow: rgba(0, 252, 244, 0.3);
            --danger: #ff3e3e;
            --success: #00ff88;
            --text: #ffffff;
            --text-dim: #71768f;
            --border: rgba(0, 252, 244, 0.15);
            --font-main: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: var(--font-main);
            overflow: hidden; 
            height: 100vh;
        }

        /* TACTICAL OVERLAY */
        body::before {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 100; opacity: 0.3;
        }

        #app {
            width: 100%; max-width: 480px; height: 100vh;
            margin: auto; background: var(--card); overflow-y: auto;
            position: relative; display: flex; flex-direction: column;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        .header { 
            padding: 24px 20px; 
            background: linear-gradient(to bottom, #141724, transparent);
            border-bottom: 1px solid var(--border);
        }

        .progress-meta { 
            display: flex; justify-content: space-between; 
            font-family: var(--font-mono); font-size: 0.7rem; 
            margin-bottom: 12px; color: var(--accent);
            text-transform: uppercase; letter-spacing: 2px;
            font-weight: 700;
        }

        .bar-container { 
            height: 4px; background: rgba(0,0,0,0.5); 
            border-radius: 2px; overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.05);
        }
        .bar-fill { 
            height: 100%; background: var(--accent); width: 0%; 
            transition: 1s cubic-bezier(0.19, 1, 0.22, 1); 
            box-shadow: 0 0 15px var(--accent-glow); 
        }

        .view { display: none; padding: 25px 20px; animation: slideIn 0.4s ease-out; }
        .view.active { display: block; }

        /* LOBBY / COMMAND CENTER */
        .lobby-title { 
            font-size: 2rem; font-weight: 900; margin-bottom: 8px; 
            text-transform: uppercase; letter-spacing: -1px;
            color: var(--text);
        }
        .lobby-intro { color: var(--text-dim); margin-bottom: 35px; line-height: 1.6; font-size: 0.95rem; }
        
        .days-grid { display: grid; gap: 16px; }
        .day-card { 
            background: rgba(255,255,255,0.02); 
            border: 1px solid var(--border); 
            padding: 24px; 
            border-radius: 20px; 
            display: flex; align-items: center; gap: 20px;
            cursor: pointer; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .day-card::after {
            content: "TACTICAL"; position: absolute; right: -10px; bottom: -5px;
            font-size: 2rem; font-weight: 900; opacity: 0.03; font-style: italic;
        }
        .day-card.locked { opacity: 0.3; filter: grayscale(1); }
        .day-card.completed { border-color: var(--success); background: rgba(0, 255, 136, 0.03); }
        
        .day-card .icon { 
            width: 50px; height: 50px; 
            background: rgba(0, 252, 244, 0.1); 
            border: 1px solid var(--accent);
            color: var(--accent);
            border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-family: var(--font-mono);
            font-size: 1.2rem;
        }
        .day-card.completed .icon { 
            background: rgba(0, 255, 136, 0.1); 
            border-color: var(--success);
            color: var(--success);
        }

        .day-info h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; }
        .day-info p { font-size: 0.85rem; color: var(--text-dim); }

        /* CONTENT */
        h2#step-title { 
            font-size: 1.5rem; font-weight: 800; color: var(--accent); 
            margin-bottom: 25px; text-transform: uppercase;
            border-left: 4px solid var(--accent); padding-left: 15px;
        }

        .content-chunk { margin-bottom: 25px; line-height: 1.7; font-size: 1.05rem; }
        
        .box-concept { 
            background: rgba(0, 252, 244, 0.05); 
            border-radius: 16px; padding: 20px; 
            border: 1px dashed var(--accent); 
            margin-bottom: 25px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }

        .hint-btn {
            background: none; border: 1px dashed var(--accent); color: var(--accent);
            padding: 8px 16px; border-radius: 8px; font-size: 0.75rem; cursor: pointer;
            margin: 10px 0; display: inline-block; opacity: 0.6; transition: 0.2s;
            text-transform: uppercase; font-weight: 700;
        }
        .hint-btn:hover { opacity: 1; background: rgba(0, 252, 244, 0.1); }
        .hint-box {
            background: rgba(255, 255, 255, 0.03); border-radius: 12px; padding: 15px;
            margin-bottom: 20px; font-size: 0.9rem; color: var(--text-dim); border: 1px solid var(--border);
            animation: fadeIn 0.3s ease-out; font-style: italic;
        }

        .btn-opt { 
            display: block; width: 100%; padding: 20px; 
            background: rgba(255,255,255,0.03); 
            border: 1px solid var(--border); 
            border-radius: 16px; color: var(--text);
            text-align: left; margin-bottom: 12px; 
            cursor: pointer; transition: 0.2s;
            font-size: 1rem; font-weight: 600;
        }
        .btn-opt:active { transform: translateX(5px); background: rgba(0, 252, 244, 0.15); }
        .btn-opt.correct { background: var(--success) !important; color: #000; border-color: var(--success); }
        .btn-opt.wrong { background: var(--danger) !important; color: #fff; border-color: var(--danger); }

        .footer-nav { 
            margin-top: auto; padding: 25px 20px; 
            background: linear-gradient(to top, #0f111a, transparent);
        }
        .btn-main { 
            width: 100%; padding: 22px; 
            background: var(--accent); border: none; 
            border-radius: 20px; 
            color: #000; font-weight: 900; 
            font-size: 1rem; text-transform: uppercase; 
            letter-spacing: 2px; cursor: pointer;
            box-shadow: 0 0 25px var(--accent-glow);
            transition: 0.3s;
        }
        .btn-main:disabled { background: #232735; color: #4b526d; box-shadow: none; }

        @keyframes slideIn { 
            from { opacity: 0; transform: translateX(20px); } 
            to { opacity: 1; transform: translateX(0); } 
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.2s ease-in-out 0s 2; }

        .hidden { display: none !important; }
        b { color: var(--accent); font-weight: 800; }
        i { color: var(--text-dim); }
    </style>
</head>
<body>

<div id="app">
    <!-- HEADER & PROGRESS BAR -->
    <div class="header">
        <div class="progress-meta">
            <span id="progress-text">SYNCHRO TACTIQUE : 0%</span>
            <span id="session-tag">CENTRE DE COMMANDE</span>
        </div>
        <div class="bar-container"><div id="main-bar" class="bar-fill"></div></div>
    </div>

    <!-- LOBBY VIEW -->
    <div id="view-lobby" class="view active">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
            <div style="width: 50px; height: 50px; background: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--accent-glow);">
                <svg viewBox="0 0 24 24" style="width: 30px; fill: #000;"><path d="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z"/></svg>
            </div>
            <h1 class="lobby-title" style="margin-bottom: 0;">Tactical Comms</h1>
        </div>
        <p class="lobby-intro">Agent Lovyc, la clart√© est ton arme principale. Ma√Ætrise la syntaxe pour coordonner tes missions et dominer le terrain.</p>
        
        <div class="days-grid" id="days-grid">
            <!-- Dynamically generated -->
        </div>
    </div>

    <!-- CONTENT VIEW (LESSON + QUIZ) -->
    <div id="view-content" class="view">
        <h2 id="step-title" style="margin-bottom:20px;"></h2>
        <div id="step-body"></div>
    </div>

    <div class="footer-nav hidden" id="footer">
        <button id="btn-next" class="btn-main">CONTINUER</button>
    </div>
</div>

<script>
    // DB & PROGRESS MANAGEMENT (LocalStorage)
    const STORAGE_KEY = "lovyc_fr_w1_v2";
    let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        completedDays: [],
        currentDay: null,
        currentStep: 0
    };

    function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    const weekData = [
        {
            id: 1,
            title: "Le Noyau : S + V + C",
            intro: "Identifier les joueurs essentiels d'une phrase pour √©viter le lag.",
            steps: [
                {
                    type: "lesson",
                    title: "Briefing : La Squad de Base",
                    content: `<p>Agent Lovyc, une phrase c'est comme une composition d'√©quipe. Si tu n'as pas de <b>Buteur</b> (Verbe), tu ne marques pas.</p>
                              <div class="box-concept">
                                <b>Sujet</b> (Qui ?) + <b>Verbe</b> (Action) + <b>Compl√©ment</b> (Quoi ?)
                              </div>
                              <p>Sans verbe, ton message est un "Lag". Personne ne comprend ce qui se passe sur le serveur.</p>`
                },
                {
                    type: "interactive",
                    title: "Scan de Zone 1",
                    question: "Dans cette phrase, quel mot est le <b>Sujet</b> (celui qui fait l'action) ? <br><br><i>'Le pro-gamer lance une attaque parfaite.'</i>",
                    options: ["l'attaque", "Le pro-gamer", "parfaite"],
                    answer: 1,
                    feedback: "Correct ! C'est le pro-gamer qui agit."
                },
                {
                    type: "interactive",
                    title: "Scan de Zone 2",
                    question: "Trouve maintenant le <b>Verbe</b> (l'action) : <br><br><i>'Le pro-gamer lance une attaque parfaite.'</i>",
                    options: ["lance", "une attaque", "pro-gamer"],
                    answer: 0,
                    feedback: "Exact ! 'Lance' est le mouvement, l'action."
                },
                {
                    type: "write",
                    title: "Saisie Tactique",
                    question: "√âcris le mot qui manque (le Verbe) pour que la phrase fonctionne : <br><br><i>'Lovyc ____ son √©cran de jeu.'</i>",
                    answer: ["allume", "regarde", "fixe", "partage"],
                    hint: "Cherche une action que l'on fait avec les yeux ou avec le bouton Power (regarde, allume, fixe...)",
                    feedback: "Bien ! N'importe lequel de ces verbes d'action valide la phrase."
                },
                {
                    type: "lesson",
                    title: "Le Danger du Verbe '√ätre'",
                    content: `<p>Attention au tic de langage : <b>'Je suis en appel'</b> ou <b>'Je suis au foot'</b>.</p>
                    <p>C'est correct, mais on cherche des verbes plus riches pour montrer que tu es le leader (Boss de guilde).</p>
                    <div class="box-concept">
                      Passif : Je suis sur mon v√©lo.<br>
                      <b>Actif :</b> Je <b>p√©dale</b> sur mon v√©lo.
                    </div>`
                },
                {
                    type: "write",
                    title: "Optimisation de Signal",
                    question: "Remplace 'suis' par un verbe d'action plus pr√©cis : <br><br><i>'Je suis dans ma chambre.'</i>",
                    answer: ["je range ma chambre", "je dors dans ma chambre", "je joue dans ma chambre", "je travaille dans ma chambre", "je range", "je dors", "je joue"],
                    hint: "Que fais-tu dans ta chambre ? (dors, joue, range...)",
                    feedback: "Gagn√© ! Un leader utilise des verbes pr√©cis pour ses ordres."
                },
                {
                    type: "interactive",
                    title: "Rep√©rage de Phrase Cass√©e",
                    question: "Laquelle de ces phrases n'a <b>PAS</b> de verbe (elle 'lag') ?",
                    options: ["Les joueurs attendent le patch.", "Demain, le gros tournoi national.", "Nous gagnons le match."],
                    answer: 1,
                    feedback: "Bien vu ! 'Demain, le gros tournoi' n'annonce aucune action. C'est une phrase incompl√®te."
                },
                {
                    type: "write",
                    title: "R√©cup√©ration de Donn√©es",
                    question: "Ajoute un verbe pour r√©parer la phrase cass√©e : <br><br><i>'Demain, le gros tournoi national ____.'</i>",
                    answer: ["commence", "d√©bute", "arrive", "stoppe"],
                    hint: "Le tournoi va-t-il bient√¥t commencer ? (8 lettres : commence / 6 lettres : d√©bute)",
                    feedback: "Phrase r√©par√©e ! Le signal est maintenant complet."
                },
                {
                    type: "lesson",
                    title: "L'Ordre Tactique",
                    content: `<p>En fran√ßais, on ne commence pas par le compl√©ment si on veut √™tre compris en 1ms.</p>
                    <div class="box-concept">
                      ‚ùå Un skin je veux acheter.<br>
                      ‚úÖ <b>Je veux acheter</b> un skin.
                    </div>
                    <p>Garde l'ordre S+V+C : Sujet puis Verbe puis Compl√©ment.</p>`
                },
                {
                    type: "write",
                    title: "R√©organisation de Comm",
                    question: "R√©√©cris cette phrase dans le bon ordre (S+V+C) : <br><br><i>'le ballon - Lovyc - lance'</i>",
                    answer: "Lovyc lance le ballon",
                    feedback: "Ordre r√©tabli. Transmission claire."
                },
                {
                    type: "interactive",
                    title: "Choix Final",
                    question: "Laquelle de ces phrases respecte l'ordre S+V+C et poss√®de un verbe d'action riche ?",
                    options: ["Dans le jeu je suis bien.", "J'√©limine mes adversaires avec pr√©cision.", "Mes amis et moi sur le serveur."],
                    answer: 1,
                    feedback: "Correct. C'est pr√©cis, actif et structur√©."
                },
                {
                    type: "challenge",
                    title: "Boss de Fin - Jour 1",
                    question: "R√©dige une phrase compl√®te (S+V+C) avec le verbe 'SMASH' :",
                    answer: ["Lovyc smash le volant", "Je smash le volant", "Il smash le volant", "Lovyc smash la balle"],
                    feedback: "F√©licitations Agent ! Mission 1 accomplie √† 100%. Ton noyau est stable."
                }
            ]
        },
        {
            id: 2,
            title: "Accord Multi-joueurs",
            intro: "Ma√Ætriser le pluriel et le code -ENT pour √©viter les bugs de lecture.",
            steps: [
                {
                    type: "lesson",
                    title: "Le Serveur Squad",
                    content: `<p>Quand tu es en solo, le verbe finit souvent par 'e' ou 's'. Mais en Squad (Pluriel), le syst√®me change.</p>
                              <p>Le code secret du pluriel pour les verbes, c'est <b>-ENT</b>.</p>
                              <div class="box-concept">
                                Solo : Le joueur <b>tire</b>.<br>
                                Squad : Les joueurs <b>tirent</b>.
                              </div>`
                },
                {
                    type: "interactive",
                    title: "Patch Correctif 1",
                    question: "Choisis la bonne terminaison : <br><br><i>'Mes co√©quipiers ____ la zone.'</i>",
                    options: ["s√©curise", "s√©curisent", "s√©curises"],
                    answer: 1,
                    feedback: "Bien jou√© ! Plusieurs co√©quipiers = terminaison -ent."
                },
                {
                    type: "write",
                    title: "Codage Manuel",
                    question: "√âcris le verbe GAGNER correctement ici : <br><br><i>'Les membres de ma guilde ____ tout le temps.'</i>",
                    answer: "gagnent",
                    feedback: "Le code -ENT est bien appliqu√©."
                },
                {
                    type: "lesson",
                    title: "Le Cas du 'ON' (Infiltr√©)",
                    content: `<p>Attention ! Le pronom <b>'ON'</b> est un agent double. Il veut dire 'nous', mais il se conjugue comme s'il √©tait <b>SOLO</b>.</p>
                              <div class="box-concept">
                                ‚úÖ On <b>part</b> en raid. (Singulier)<br>
                                ‚ùå On partent en raid. (Bug !)
                              </div>`
                },
                {
                    type: "write",
                    title: "Infiltration",
                    question: "Accorde le verbe JOUER : <br><br><i>'On ____ souvent ensemble.'</i>",
                    answer: "joue",
                    feedback: "Exact ! 'On' se comporte comme 'Il' au singulier."
                },
                {
                    type: "interactive",
                    title: "D√©tection de Faille",
                    question: "Trouve la phrase qui contient une erreur d'accord :",
                    options: ["On joue ensemble.", "Ils courent vite.", "Les adversaires arrive."],
                    answer: 2,
                    feedback: "Correct ! 'Les adversaires' (pluriel) devrait prendre -ent : arrivent."
                },
                {
                    type: "write",
                    title: "Correction de Bug",
                    question: "Corrige le verbe de cette phrase : <br><br><i>'Mes parents regarde mon match.'</i>",
                    answer: "regardent",
                    feedback: "Fix r√©ussi ! Tes parents (ils) = regardent."
                },
                {
                    type: "lesson",
                    title: "Mixit√© : Moi + Toi",
                    content: `<p>Si tu dis 'Mon pote et moi', c'est comme si tu disais <b>NOUS</b>.</p>
                              <div class="box-concept">
                                Mon pote et moi <b>jouons</b>. (-ONS)
                              </div>`
                },
                {
                    type: "write",
                    title: "Liaison Radio",
                    question: "Accorde le verbe COURIR : <br><br><i>'Mon cousin et moi ____ vers le but.'</i>",
                    answer: "courons",
                    feedback: "Bien ! Lui + Moi = Nous."
                },
                {
                    type: "challenge",
                    title: "Boss de Fin - Jour 2",
                    question: "R√©√©cris toute cette phrase sans aucune erreur : <br><br><i>'Les joueurs saute sur le terrain.'</i>",
                    answer: "Les joueurs sautent sur le terrain",
                    feedback: "Mission accomplie ! L'accord de la squad est parfait."
                }
            ]
        },
        {
            id: 3,
            title: "Le Flux Dynamique",
            intro: "Rythmer ses messages avec la ponctuation pour ne pas s'essouffler.",
            steps: [
                {
                    type: "lesson",
                    title: "Le Scan de Ponctuation",
                    content: `<p>Un mur de texte sans points, c'est comme un jeu qui freeze. Ton interlocuteur perd le fil.</p>
                              <div class="box-concept">
                                Point (.) = Fin d'action.<br>
                                Virgule (,) = Pause ou Liste.
                              </div>`
                },
                {
                    type: "write",
                    title: "Split de Signal",
                    question: "S√©pare ces deux actions par un point : <br><br><i>'Le match commence Lovyc se pr√©pare.'</i>",
                    answer: "Le match commence. Lovyc se pr√©pare",
                    feedback: "Parfait. Deux actions, deux phrases."
                },
                {
                    type: "lesson",
                    title: "La Virgule (Le Boost)",
                    content: `<p>La virgule sert √† lister des objets ou donner un d√©tail sans couper le courant.</p>
                              <div class="box-concept">
                                Dans mon sac, j'ai une raquette, une gourde et des balles.
                              </div>`
                },
                {
                    type: "write",
                    title: "Inventaire Tactical",
                    question: "Ajoute les virgules manquantes pour lister ton stuff : <br><br><i>'J'aime le basket le badminton et Valorant.'</i>",
                    answer: "J'aime le basket, le badminton et Valorant",
                    feedback: "Exact. On ne met pas de virgule avant le 'et', il fait d√©j√† le lien."
                },
                {
                    type: "write",
                    title: "Saisie de Pr√©cision",
                    question: "√âcris une phrase o√π tu listes 3 jeux que tu aimes, avec les virgules au bon endroit :",
                    answer: ["j'aime", "joue", "jeux"],
                    feedback: "Signal valid√©. Ta liste est bien structur√©e."
                },
                {
                    type: "interactive",
                    title: "Correction de Chat",
                    question: "O√π placer la virgule ? <br><br><i>'Si tu gagnes je te rejoins.'</i>",
                    options: ["Si tu gagnes, je te rejoins.", "Si tu, gagnes je te rejoins.", "Si tu gagnes je te, rejoins."],
                    answer: 0,
                    feedback: "Correct ! La virgule marque la condition."
                },
                {
                    type: "write",
                    title: "Echo Tactique",
                    question: "Transforme cette question en affirmation point√©e : <br><br><i>'Est-ce que le serveur est ouvert ?'</i>",
                    answer: "Le serveur est ouvert",
                    feedback: "Transmission claire et directe."
                },
                {
                    type: "lesson",
                    title: "L'Exclamation (Le Cri)",
                    content: `<p>√Ä utiliser avec parcimonie pour montrer l'urgence ou la joie.</p>
                              <div class="box-concept">
                                ‚úÖ Attention derri√®re toi !<br>
                                ‚ùå Pourquoi tu fais √ßa !!?!!! (Trop de bruit)
                              </div>`
                },
                {
                    type: "write",
                    title: "Alerte Squad",
                    question: "√âcris un message d'alerte pour tes co√©quipiers avec un point d'exclamation :",
                    answer: ["!", "attention", "danger", "vite"],
                    feedback: "Alerte re√ßue 5/5."
                },
                {
                    type: "challenge",
                    title: "Boss de Fin - Jour 3",
                    question: "R√©√©cris proprement ce message qui lag : <br><br><i>'y'a plus de batterie j'arr√™te l'appel'</i>",
                    answer: ["Il n'y a plus de batterie, j'arr√™te l'appel", "Y'a plus de batterie, j'arr√™te l'appel", "Il n'y a plus de batterie. J'arr√™te l'appel"],
                    feedback: "Mission accomplie. Le flux est fluide."
                }
            ]
        },
        {
            id: 4,
            title: "Nettoyage de Comm (Et vs Est)",
            intro: "Distinguer le verbe √™tre de la liaison pour √©viter les malentendus.",
            steps: [
                {
                    type: "lesson",
                    title: "L'Analyse du Signal",
                    content: `<p>C'est l'erreur la plus courante. Si tu les confonds, ton message perd sa force.</p>
                              <div class="box-concept">
                                <b>EST</b> = Verbe √ätre (On peut le remplacer par '√©tait').<br>
                                <b>ET</b> = Liaison (On peut le remplacer par 'et aussi').
                              </div>`
                },
                {
                    type: "write",
                    title: "Diagnostic 1",
                    question: "Compl√®te : <i>'Le niveau ____ difficile.'</i>",
                    answer: "est",
                    feedback: "Oui ! Le niveau '√©tait' difficile -> donc EST."
                },
                {
                    type: "write",
                    title: "Diagnostic 2",
                    question: "Compl√®te : <i>'Je prends mon sac ____ ma raquette.'</i>",
                    answer: "et",
                    feedback: "Bien ! 'Et aussi' ma raquette -> donc ET."
                },
                {
                    type: "interactive",
                    title: "Double Diagnostic",
                    question: "Trouve la bonne combinaison : <i>'Il ___ tard ___ je suis fatigu√©.'</i>",
                    options: ["et / est", "est / et", "est / est"],
                    answer: 1,
                    feedback: "Parfait. 'Il √©tait tard et aussi je suis fatigu√©'."
                },
                {
                    type: "lesson",
                    title: "Le Cas du 'A' vs '√Ä'",
                    content: `<p>M√™me logique ici :</p>
                              <div class="box-concept">
                                <b>A</b> = Verbe Avoir (On peut dire 'avait').<br>
                                <b>√Ä</b> = Direction ou Lieu (Position).
                              </div>`
                },
                {
                    type: "write",
                    title: "Navigation GPS",
                    question: "Compl√®te : <i>'Lovyc ___ gagn√© ___ Lyon.'</i>",
                    answer: "a √†",
                    hint: "Astuces : 'a' sans accent = il avait. '√†' avec accent = direction/lieu Lyon.",
                    feedback: "Top ! 'A' (avait) gagn√© '√Ä' (lieu) Lyon."
                },
                {
                    type: "write",
                    title: "R√©cup√©ration",
                    question: "Corrige cette phrase : <i>'Il √† faim.'</i>",
                    answer: "Il a faim",
                    hint: "Peux-tu dire 'Il avait faim' ? Si oui, pas d'accent !",
                    feedback: "Exact. On peut dire 'Il avait faim'."
                },
                {
                    type: "interactive",
                    title: "D√©tection Rapide",
                    question: "Laquelle est juste ?",
                    options: ["Je vais a la plage.", "Il a une nouvelle console.", "C'est etrange et beau."],
                    answer: 1,
                    feedback: "Correct."
                },
                {
                    type: "write",
                    title: "Saisie de S√©curit√©",
                    question: "Compl√®te : <i>'Le coach ____ l√† ____ il nous regarde.'</i>",
                    answer: "est et",
                    hint: "1. Verbe √™tre (avait √©t√©/√©tait). 2. Liaison (et aussi).",
                    feedback: "Clean ! Signal pur."
                },
                {
                    type: "challenge",
                    title: "Boss de Fin - Jour 4",
                    question: "Saisis la phrase suivante sans erreur : <br><br><i>'Le pro est fatigu√© et il a sommeil.'</i>",
                    answer: "Le pro est fatigu√© et il a sommeil",
                    feedback: "Excellent ! Tu as nettoy√© ton signal."
                }
            ]
        },
        {
            id: 5,
            title: "Certification Leader",
            intro: "Derni√®re mission de la semaine. Prouve que tu es pr√™t √† diriger.",
            steps: [
                {
                    type: "lesson",
                    title: "Checklist du Leader",
                    content: `<p>Pour √™tre un Leader d'expression, n'oublie jamais :<br>1. Le <b>Sujet</b> est clair.<br>2. Le <b>Verbe</b> est pr√©cis et bien accord√©.<br>3. Les <b>Liaisons</b> (et/est) sont v√©rifi√©es.<br>4. La <b>Ponctuation</b> valide le message.</p>`
                },
                {
                    type: "write",
                    title: "√âpreuve de Force 1",
                    question: "Corrige cette phrase : <i>'Ils vas au tournoi √† Bordeaux.'</i>",
                    answer: "Ils vont au tournoi √† Bordeaux",
                    hint: "Accorde le verbe 'aller' avec 'Ils' (pluriel).",
                    feedback: "Bien. 'Ils vont' (pluriel) et '√†' (lieu)."
                },
                {
                    type: "write",
                    title: "√âpreuve de Force 2",
                    question: "Corrige cette phrase : <i>'Le micro est cass√© j'en veut un autre.'</i>",
                    answer: "Le micro est cass√©. J'en veux un autre",
                    hint: "S√©pare les deux id√©es par un point (.) et v√©rifie la fin du verbe 'vouloir' avec 'JE'.",
                    feedback: "Exactement ! Point pour s√©parer + orthographe correcte du verbe."
                },
                {
                    type: "write",
                    title: "√âpreuve de Force 3",
                    question: "Remets de l'ordre : <br><br><i>'gagnons - nous - le match - ensemble'</i>",
                    answer: "Nous gagnons le match ensemble",
                    hint: "Respecte l'ordre S+V+C (Sujet + Verbe + Compl√©ment).",
                    feedback: "Structure parfaite."
                },
                {
                    type: "interactive",
                    title: "Audit de Signal",
                    question: "Laquelle est fausse ?",
                    options: ["Les joueurs courent.", "On mangent dehors.", "Tu es pr√™t."],
                    answer: 1,
                    feedback: "On mange (singulier)."
                },
                {
                    type: "write",
                    title: "Refactorisation",
                    question: "R√©√©cris 'On mangent dehors' correctement :",
                    answer: "On mange dehors",
                    feedback: "Corrig√©."
                },
                {
                    type: "write",
                    title: "Derni√®re Liaison",
                    question: "Compl√®te : <i>'Lovyc ___ fort ___ rapide.'</i>",
                    answer: "est et",
                    feedback: "Impeccable."
                },
                {
                    type: "challenge",
                    title: "BOSS FINAL : La Transmission Claire",
                    question: "R√©dige une phrase de leader pour encourager ton √©quipe (S+V+C + √©motion !) :",
                    answer: ["!", "gagne", "allez", "joue"],
                    feedback: "INCROYABLE ! Mission de la semaine accomplie √† 100%. Tu es le Squad Leader de l'expression."
                }
            ]
        }
    ];

    const el = {
        lobby: document.getElementById('view-lobby'),
        content: document.getElementById('view-content'),
        grid: document.getElementById('days-grid'),
        bar: document.getElementById('main-bar'),
        progText: document.getElementById('progress-text'),
        tag: document.getElementById('session-tag'),
        footer: document.getElementById('footer'),
        btnNext: document.getElementById('btn-next'),
        stepTitle: document.getElementById('step-title'),
        stepBody: document.getElementById('step-body')
    };

    function init() {
        renderLobby();
        updateGlobalProgress();
        
        el.btnNext.onclick = () => {
            const day = weekData.find(d => d.id === state.currentDay);
            if (state.currentStep < day.steps.length - 1) {
                state.currentStep++;
                renderStep();
            } else {
                completeDay();
            }
            saveState();
        };
    }

    function updateGlobalProgress() {
        const total = weekData.length;
        const count = state.completedDays.length;
        const percent = Math.round((count / total) * 100);
        el.bar.style.width = percent + "%";
        el.progText.innerText = `SYNCHRO TACTIQUE : ${percent}%`;
    }

    function renderLobby() {
        el.lobby.classList.add('active');
        el.content.classList.remove('active');
        el.footer.classList.add('hidden');
        el.tag.innerText = "CENTRE DE COMMANDE";
        el.grid.innerHTML = "";

        weekData.forEach((day, index) => {
            const isLocked = index > 0 && !state.completedDays.includes(weekData[index-1].id);
            const isDone = state.completedDays.includes(day.id);
            
            const card = document.createElement('div');
            card.className = `day-card ${isLocked ? 'locked' : ''} ${isDone ? 'completed' : ''}`;
            
            // Ic√¥nes tactiques par mission
            const icons = [
                '<svg viewBox="0 0 24 24" style="width:24px;height:24px"><path fill="currentColor" d="M12,2L4.5,20.29L5.21,21L12,18L18.79,21L19.5,20.29L12,2Z"/></svg>', 
                '<svg viewBox="0 0 24 24" style="width:24px;height:24px"><path fill="currentColor" d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H21V16.5C21,14.67 19.7,13.21 17.83,12.41C17.39,12.15 16.79,12 16,12L16,13M8,13C6.17,13 4,14.08 4,16V19H12V16C12,14.08 9.83,13 8,13M8,12A3,3 0 0,0 11,9A3,3 0 0,0 8,6A3,3 0 0,0 5,9A3,3 0 0,0 8,12M16,11A2,2 0 0,0 18,9A2,2 0 0,0 16,7A2,2 0 0,0 14,9A2,2 0 0,0 16,11M8,14C10.21,14 13,15.12 13,17V20H3V17C4,15.12 5.79,14 8,14Z"/></svg>',
                '<svg viewBox="0 0 24 24" style="width:24px;height:24px"><path fill="currentColor" d="M14,10H2V12H14V10M14,6H2V8H14V6M2,16H10V14H2V16M21.5,11.5L23,13L16,20L11.5,15.5L13,14L16,17L21.5,11.5Z"/></svg>',
                '<svg viewBox="0 0 24 24" style="width:24px;height:24px"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6V12L16,14.5L16.8,13.2L13.5,11.2V6H12Z"/></svg>',
                '<svg viewBox="0 0 24 24" style="width:24px;height:24px"><path fill="currentColor" d="M12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4Z"/></svg>'
            ];

            card.innerHTML = `
                <div class="icon">${isDone ? '‚úì' : icons[index]}</div>
                <div class="day-info">
                    <h3>MISSION ${day.id} : ${day.title}</h3>
                    <p>${day.intro}</p>
                </div>
            `;
            
            if (!isLocked) {
                card.onclick = () => startDay(day.id);
            }
            el.grid.appendChild(card);
        });
    }

    function startDay(id) {
        state.currentDay = id;
        state.currentStep = 0;
        el.lobby.classList.remove('active');
        el.content.classList.add('active');
        el.footer.classList.remove('hidden');
        el.tag.innerText = `MISSION ${id}`;
        renderStep();
        saveState();
    }

    function renderStep() {
        const day = weekData.find(d => d.id === state.currentDay);
        const step = day.steps[state.currentStep];
        
        el.stepTitle.innerText = step.title;
        el.btnNext.disabled = ['interactive', 'quiz', 'challenge', 'write'].includes(step.type);
        el.btnNext.innerText = (state.currentStep === day.steps.length - 1) ? "VALIDER LA MISSION" : "√âTAPE SUIVANTE";

        if (step.type === 'lesson') {
            el.stepBody.innerHTML = step.content;
        } else if (step.type === 'write') {
            el.stepBody.innerHTML = `<p class="content-chunk">${step.question}</p>`;
            const container = document.createElement('div');
            container.style.marginTop = "20px";
            
            if (step.hint) {
                const hintBtn = document.createElement('button');
                hintBtn.className = "hint-btn";
                hintBtn.innerText = "üí° BESOIN D'UN INDICE ?";
                const hintBox = document.createElement('div');
                hintBox.className = "hint-box hidden";
                hintBox.innerHTML = `<b>Indice :</b> ${step.hint}`;
                hintBtn.onclick = () => {
                    hintBox.classList.toggle('hidden');
                    hintBtn.innerText = hintBox.classList.contains('hidden') ? "üí° BESOIN D'UN INDICE ?" : "üí° MASQUER L'INDICE";
                };
                el.stepBody.appendChild(hintBtn);
                el.stepBody.appendChild(hintBox);
            }

            const input = document.createElement('input');
            input.type = "text";
            input.placeholder = "Tape ta r√©ponse ici...";
            input.className = "btn-opt";
            input.style.cursor = "text";
            input.style.background = "rgba(0,0,0,0.2)";
            input.style.border = "1px solid var(--accent)";
            
            const checkBtn = document.createElement('button');
            checkBtn.className = "btn-main";
            checkBtn.style.marginTop = "10px";
            checkBtn.innerText = "V√âRIFIER LE SIGNAL";
            
            container.appendChild(input);
            container.appendChild(checkBtn);
            el.stepBody.appendChild(container);

            input.onkeydown = (e) => { if (e.key === 'Enter') checkBtn.click(); };
            
            checkBtn.onclick = () => {
                const userVal = input.value.trim().toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");
                const solutions = Array.isArray(step.answer) ? step.answer : [step.answer];
                const isCorrect = solutions.some(s => {
                    const cleanS = s.toLowerCase().trim().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");
                    return userVal === cleanS;
                });
                
                if (isCorrect) {
                    input.disabled = true;
                    checkBtn.disabled = true;
                    input.style.borderColor = "var(--success)";
                    const f = document.createElement('p');
                    f.style.marginTop = "15px";
                    f.style.color = "var(--success)";
                    f.innerHTML = `<b>‚úì SIGNAL CLAIR :</b> ${step.feedback}`;
                    el.stepBody.appendChild(f);
                    el.btnNext.disabled = false;
                } else {
                    input.classList.add('shake');
                    setTimeout(() => input.classList.remove('shake'), 400);
                }
            };
        } else {
            el.stepBody.innerHTML = `<p class="content-chunk">${step.question}</p>`;
            const area = document.createElement('div');
            area.className = "interactive-area";
            
            step.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "btn-opt";
                btn.innerText = opt;
                btn.onclick = () => {
                    const btns = area.querySelectorAll('.btn-opt');
                    btns.forEach(b => b.disabled = true);
                    
                    if (i === step.answer) {
                        btn.classList.add('correct');
                        const f = document.createElement('p');
                        f.style.marginTop = "15px";
                        f.style.color = "var(--success)";
                        f.innerHTML = `<b>‚úì</b> ${step.feedback}`;
                        el.stepBody.appendChild(f);
                        el.btnNext.disabled = false;
                    } else {
                        btn.classList.add('wrong');
                        setTimeout(() => {
                            btn.classList.remove('wrong');
                            btns.forEach(b => b.disabled = false);
                        }, 600);
                    }
                };
                area.appendChild(btn);
            });
            el.stepBody.appendChild(area);
        }
        el.content.scrollTop = 0;
    }

    function completeDay() {
        if (!state.completedDays.includes(state.currentDay)) {
            state.completedDays.push(state.currentDay);
        }
        state.currentDay = null;
        state.currentStep = 0;
        renderLobby();
        updateGlobalProgress();
        
        const congrats = document.createElement('div');
        congrats.style = "position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:var(--accent); color:#000; padding:20px 40px; border-radius:15px; font-weight:900; z-index:100; animation: slideIn 0.3s; box-shadow: 0 0 30px var(--accent-glow); text-transform:uppercase; letter-spacing:2px;";
        congrats.innerText = "MISSION ACCOMPLIE ! +100 COMP";
        document.body.appendChild(congrats);
        setTimeout(() => congrats.remove(), 1500);
    }

    init();
</script>

</body>
</html>
